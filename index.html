<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>What I Spend</title>

  <style>
    :root{
      --bg: #f2ede9;
      --card: rgba(255,255,255,0.78);
      --card2: rgba(255,255,255,0.62);
      --text: #2f2f2f;
      --sub: rgba(0,0,0,0.55);
      --line: rgba(0,0,0,0.08);
      --blue: #007aff;
      --shadow: 0 18px 40px rgba(0,0,0,0.10);
      --radius: 22px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 50% -150px, rgba(255,255,255,0.9), transparent 55%),
                  linear-gradient(#f6f1ee, var(--bg));
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
      min-height:100vh;
      padding: env(safe-area-inset-top) 18px env(safe-area-inset-bottom);
      display:grid;
      place-items:center;
    }

    .wrap{
      width:min(520px, 100%);
      display:grid;
      gap:14px;
      align-items:center;
    }

    /* iOS-like modal card */
    .modal{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    .header{
      padding: 18px 18px 14px;
      display:flex;
      align-items:flex-start;
      gap:12px;
    }
    .appicon{
      width:52px;height:52px;
      border-radius: 16px;
      background: rgba(255,255,255,0.72);
      border: 1px solid rgba(0,0,0,0.06);
      display:grid;
      place-items:center;
      font-size: 28px;
      flex:0 0 auto;
    }
    .ttl{
      display:grid;
      gap:4px;
      padding-top:2px;
      min-width:0;
    }
    .ttl h1{
      margin:0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -.2px;
    }
    .ttl p{
      margin:0;
      font-size: 13px;
      font-weight: 800;
      color: var(--sub);
      line-height: 1.35;
    }

    .body{
      padding: 0 18px 16px;
      display:grid;
      gap:12px;
    }

    .note{
      background: var(--card2);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 16px;
      padding: 12px 12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .note .ic{ font-size:18px; line-height:1.2; margin-top:1px; }
    .note .tx{
      display:grid; gap:4px; min-width:0;
    }
    .note .tx .t{
      font-size: 14px;
      font-weight: 900;
    }
    .note .tx .d{
      font-size: 12px;
      font-weight: 800;
      color: var(--sub);
      line-height: 1.4;
    }

    .steps{
      display:grid;
      gap:10px;
    }
    .step{
      background: rgba(255,255,255,0.65);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 16px;
      padding: 12px 12px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .badge{
      width:26px;height:26px;
      border-radius: 9px;
      background: rgba(0,0,0,0.06);
      display:grid;
      place-items:center;
      font-weight: 900;
      font-size: 13px;
      flex: 0 0 auto;
    }
    .step .s{
      font-size: 13px;
      font-weight: 900;
      color: var(--text);
      line-height: 1.35;
    }
    .step .s small{
      display:block;
      font-weight: 800;
      color: var(--sub);
      margin-top:2px;
      font-size: 12px;
    }

    .actions{
      display:grid;
      gap:10px;
      padding: 14px 18px 18px;
      border-top: 1px solid rgba(0,0,0,0.06);
      background: rgba(255,255,255,0.50);
    }
    .btn{
      width:100%;
      border: 0;
      border-radius: 16px;
      padding: 13px 14px;
      font-weight: 900;
      font-size: 15px;
      cursor:pointer;
      background: rgba(255,255,255,0.70);
      border: 1px solid rgba(0,0,0,0.08);
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      -webkit-user-select:none;
      transition: transform .10s ease, opacity .15s ease;
    }
    .btn:active{ transform: scale(.99); opacity: .85; }

    .btn.primary{
      background: var(--blue);
      color:#fff;
      border: 0;
    }

    .tiny{
      text-align:center;
      color: var(--sub);
      font-size: 12px;
      font-weight: 800;
      line-height: 1.5;
      padding: 0 12px;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(env(safe-area-inset-bottom) + 18px);
      transform: translateX(-50%);
      background: rgba(0,0,0,0.82);
      color:#fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 800;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }

    .hide{ display:none !important; }
  </style>
</head>
<body>

<div class="wrap">
  <div class="modal" id="guideCard">
    <div class="header">
      <div class="appicon">ğŸ’°</div>
      <div class="ttl">
        <h1>éœ€è¦ç”¨ Safari é–‹å•Ÿ</h1>
        <p>ç‚ºäº†é †åˆ©å®Œæˆ Google ç™»å…¥ï¼ˆå«é›™é‡é©—è­‰/Passkeyï¼‰<br>è«‹ç”¨ Safari é–‹å•Ÿé€™å€‹é€£çµã€‚</p>
      </div>
    </div>

    <div class="body">
      <div class="note">
        <div class="ic">ğŸ”’</div>
        <div class="tx">
          <div class="t">ç›®å‰çš„ç€è¦½å™¨ç’°å¢ƒæœƒè¢« Google æ“‹æ‰</div>
          <div class="d">åƒ LINE / IG / Facebook å…§å»ºç€è¦½å™¨æˆ–ä¸»ç•«é¢ Appï¼ˆPWAï¼‰å¸¸å‡ºç¾ 403 disallowed_useragentã€‚</div>
        </div>
      </div>

      <div class="steps">
        <div class="step">
          <div class="badge">1</div>
          <div class="s">
            åœ¨å³ä¸Šè§’é»ã€Œâ‹¯ã€æˆ–ã€Œåˆ†äº«ã€æŒ‰éˆ•
            <small>ï¼ˆLINE / IG è£¡é€šå¸¸åœ¨å³ä¸Šè§’ï¼‰</small>
          </div>
        </div>
        <div class="step">
          <div class="badge">2</div>
          <div class="s">
            é¸ã€Œåœ¨ Safari ä¸­é–‹å•Ÿã€
            <small>é–‹å•Ÿå¾Œå°±èƒ½æ­£å¸¸ç™»å…¥èˆ‡åŒæ­¥</small>
          </div>
        </div>
      </div>

      <div class="tiny">
        ä½ ä¹Ÿå¯ä»¥å…ˆè¤‡è£½é€£çµï¼Œæ‰“é–‹ Safari å¾Œè²¼ä¸Šå‰å¾€ã€‚
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" id="copyBtn">ğŸ“‹ è¤‡è£½ Safari é€£çµ</button>
      <a class="btn" id="tryBtn" href="onboarding.html">æˆ‘å·²åœ¨ Safariï¼Œç¹¼çºŒ â†’</a>
    </div>
  </div>

  <div class="tiny" id="footHint">
    è‹¥ä½ å·²ç”¨ Safari æ‰“é–‹ï¼Œæœƒè‡ªå‹•é€²å…¥é–‹å§‹ä½¿ç”¨é ã€‚
  </div>
</div>

<div class="toast" id="toast">å·²è¤‡è£½ âœ… è«‹æ‰“é–‹ Safari è²¼ä¸Šå‰å¾€</div>

<script>
  const ua = navigator.userAgent || "";

  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  const isSafari = isIOS && /Safari/i.test(ua) && !/CriOS|FxiOS|EdgiOS/i.test(ua);

  // iOS PWAï¼ˆåŠ åˆ°ä¸»ç•«é¢ï¼‰åˆ¤æ–·
  const isStandalone =
    window.matchMedia?.("(display-mode: standalone)")?.matches ||
    window.navigator.standalone === true;

  // å…§åµŒç€è¦½å™¨ç²—åˆ¤ï¼ˆLINE/IG/FB ç­‰ï¼‰
  const isInApp =
    /FBAN|FBAV|Instagram|Line|LIFF|Messenger|Twitter|TikTok|MicroMessenger/i.test(ua);

  // è‹¥æ˜¯ Safariï¼ˆä¸”ä¸æ˜¯ standaloneï¼‰ï¼Œç›´æ¥é€² onboarding
  // ï¼ˆstandalone/PWA æœƒå›  Google OAuth 403ï¼Œæ¯”è¼ƒå»ºè­°å› Safariï¼‰
  if (isSafari && !isStandalone) {
    location.replace("onboarding.html");
  }

  const copyBtn = document.getElementById("copyBtn");
  const toast = document.getElementById("toast");

  function showToast(){
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1600);
  }

  copyBtn.addEventListener("click", async () => {
    const url = (location.origin + location.pathname).replace(/\/$/, "/") + "onboarding.html";
    try {
      await navigator.clipboard.writeText(url);
      showToast();
    } catch (e) {
      // fallbackï¼šè®“ä½¿ç”¨è€…æ‰‹å‹•è¤‡è£½
      prompt("è«‹è¤‡è£½é€™å€‹é€£çµï¼Œä¸¦ç”¨ Safari é–‹å•Ÿï¼š", url);
    }
  });

  // å¦‚æœä¸æ˜¯ iOSï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®“ä»–é€² onboardingï¼ˆæ¡Œæ©Ÿ/Androidï¼‰
  if (!isIOS) {
    location.replace("onboarding.html");
  }
</script>

</body>
</html>