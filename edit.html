<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç·¨è¼¯æ˜ç´°</title>
  <style>
    :root{
      --app-bg:#f3e7e3;
      --card-bg:rgba(0,0,0,0.06);
      --text:#111;
      --secondary:rgba(0,0,0,0.45);
      --accent:#4f55d8;
      --radius:16px;
      --page-padding:16px;
      --tab-height:84px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--app-bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    }
    .app{min-height:100vh;padding-bottom:18px}
    .page{max-width:520px;margin:0 auto;padding:18px var(--page-padding) 28px}
    .nav{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 0 6px;
    }
    .back{
      text-decoration:none;color:var(--accent);font-weight:800;
    }
    .title{
      font-size:34px;font-weight:900;margin:6px 0 12px;letter-spacing:-.4px;
    }
    .card{background:var(--card-bg);border-radius:var(--radius);padding:16px}
    .field{display:grid;gap:8px;margin-top:14px}
    .field:first-child{margin-top:0}
    .label{font-size:14px;font-weight:900;color:var(--secondary)}
    .input, select{
      width:100%;
      padding:12px 12px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.12);
      background:#fff;
      font-size:16px;
    }
    /* ğŸ”§ ä¿®æ­£ iOS date / time input æº¢å‡ºå•é¡Œ */
    input,
    select {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    }

    /* ç‰¹åˆ¥è™•ç† iOS date / time */
    input[type="date"],
    input[type="time"] {
    display: block;
    appearance: none;
    -webkit-appearance: none;
    }

    /* ç¢ºä¿ field ä¸æœƒæ’çˆ† card */
    .field {
    width: 100%;
    min-width: 0;
    }
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btnbar{margin-top:14px;display:grid;gap:10px}
    .btn{
      width:100%;
      padding:14px 16px;
      border:0;border-radius:16px;
      background:var(--card-bg);
      font-size:18px;font-weight:900;
      cursor:pointer;
    }
    .btn.primary{background:var(--accent);color:#fff}
    .hint{margin-top:10px;color:var(--secondary);font-size:12px}
  </style>
</head>
<body>
  <div class="app">
    <main class="page">
      <div class="nav">
        <a class="back" id="backLink" href="month.html">â€¹ è¿”å›</a>
        <div></div>
      </div>

      <div class="title">ç·¨è¼¯æ˜ç´°</div>

      <div class="card">
        <div class="field">
          <div class="label">æ—¥æœŸ</div>
          <input class="input" type="date" id="date" />
        </div>

        <div class="field">
          <div class="label">æ™‚é–“</div>
          <input class="input" type="time" id="time" />
        </div>

        <div class="field">
          <div class="label">åˆ†é¡</div>
          <input class="input" type="text" id="category" placeholder="ä¾‹å¦‚ï¼šé£²æ–™" />
        </div>

        <div class="row2">
          <div class="field">
            <div class="label">é¡å‹</div>
            <select class="input" id="type">
              <option value="expense">æ”¯å‡º</option>
              <option value="income">æ”¶å…¥</option>
            </select>
          </div>

          <div class="field">
            <div class="label">é‡‘é¡</div>
            <input class="input" type="number" id="amount" placeholder="ä¾‹å¦‚ï¼š200" />
          </div>
        </div>

        <div class="field">
          <div class="label">å‚™è¨»</div>
          <input class="input" type="text" id="note" placeholder="ï¼ˆå¯ç©ºï¼‰" />
        </div>
      </div>

      <div class="btnbar">
        <button class="btn primary" type="button" onclick="save()">å„²å­˜</button>
        <button class="btn" type="button" onclick="removeTx()">åˆªé™¤</button>
      </div>

      <div class="hint">æ­¤ç‰ˆæœ¬ç”¨ localStorage æ¨¡æ“¬è³‡æ–™ç·¨è¼¯ï¼ˆéœæ…‹ HTML ç„¡ SwiftDataï¼‰ã€‚</div>
    </main>
  </div>

  <script>
    const qs = new URLSearchParams(location.search);
    const id = qs.get("id") || "tx-unknown";

    // å›ä¸Šä¸€é ï¼ˆå¯å¾ ref å¸¶å›å»ï¼‰
    const ref = qs.get("ref") || "month.html";
    document.getElementById("backLink").href = ref;

    function pad2(n){ return String(n).padStart(2,"0"); }

    // å°‡ query é å¡«å…¥è¡¨å–®ï¼ˆæ²’æœ‰çš„å°±ç©ºï¼‰
    function init(){
      // å…è¨± month.html å…ˆæŠŠè³‡æ–™å­˜å…¥ localStorageï¼Œå†å¾é€™è£¡è®€
      const saved = localStorage.getItem("tx:"+id);
      let data = null;

      if(saved){
        try{ data = JSON.parse(saved); }catch(e){}
      }else{
        // æ²’å­˜éå°±ç”¨ query ç•¶åˆå§‹å€¼
        data = {
          id,
          date: qs.get("date") || "",
          time: qs.get("time") || "",
          category: qs.get("cat") || "",
          note: qs.get("note") || "",
          type: qs.get("type") || "expense",
          amount: qs.get("amount") || ""
        };
      }

      document.getElementById("date").value = data.date || "";
      document.getElementById("time").value = data.time || "";
      document.getElementById("category").value = data.category || "";
      document.getElementById("note").value = data.note || "";
      document.getElementById("type").value = data.type || "expense";
      document.getElementById("amount").value = data.amount || "";
    }

    function save(){
      const data = {
        id,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        category: document.getElementById("category").value.trim(),
        note: document.getElementById("note").value.trim(),
        type: document.getElementById("type").value,
        amount: document.getElementById("amount").value
      };

      // åŸºæœ¬é©—è­‰
      const amt = Number(String(data.amount).replace(/,/g,""));
      if(!isFinite(amt) || amt <= 0){
        alert("è«‹è¼¸å…¥æ­£ç¢ºé‡‘é¡ï¼ˆ> 0ï¼‰");
        return;
      }

      localStorage.setItem("tx:"+id, JSON.stringify(data));
      alert("å·²å„²å­˜ï¼ˆlocalStorageï¼‰");

      // å›åˆ°ä¾†æºé 
      location.href = ref;
    }

    function removeTx(){
      if(!confirm("ç¢ºå®šåˆªé™¤é€™ç­†æ˜ç´°ï¼Ÿ")) return;
      localStorage.removeItem("tx:"+id);
      localStorage.setItem("tx:deleted:"+id, "1");
      location.href = ref;
    }

    init();
  </script>
</body>
</html>