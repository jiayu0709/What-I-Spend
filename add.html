<!doctype html>
<html lang="zh-Hant">
<head>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="theme.css">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="What I Spend">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <title>Êñ∞Â¢û</title>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--app-bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    }
    .app{min-height:100vh;padding-bottom:var(--tab-height)}
    .page{max-width:520px;margin:0 auto;padding:18px var(--page-padding) 28px}

    .nav-title{font-size:42px;font-weight:800;margin:10px 0 14px;letter-spacing:-.5px}
    .section{margin-top:18px}
    .label{font-size:14px;font-weight:800;color:var(--secondary);margin:10px 0 8px}
    .card{background:var(--card-bg);border-radius:var(--radius);padding:16px}

    .segment{
      display:grid;grid-template-columns:1fr 1fr;
      background:var(--card-bg);border-radius:12px;padding:4px;
    }
    .seg-btn{
      border:0;background:transparent;padding:10px 0;border-radius:10px;
      font-weight:800;color:var(--secondary);cursor:pointer;
    }
    .seg-btn.active{background:#fff;color:var(--text)}

    .field{display:grid;gap:8px;margin-top:14px}
    .field:first-child{margin-top:0}

    .input, select{
      width:100%;
      padding:12px 12px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.12);
      background:#fff;
      font-size:16px;
    }
    input, select{
      width:100%;
      max-width:100%;
      box-sizing:border-box;
    }
    input[type="date"]{
      display:block;
      appearance:none;
      -webkit-appearance:none;
    }

    .field, .card{min-width:0;}

    .save{
      margin-top:14px;
      width:100%;
      padding:14px 16px;
      border:0;
      border-radius:16px;
      background:var(--card-bg);
      font-size:18px;
      font-weight:800;
      cursor:pointer;
      color:var(--accent-text);
    }

    /* ===== Tab bar ===== */
    .tabbar{
      position:fixed;left:0;right:0;bottom:0;height:var(--tab-height);
      background:rgba(255,255,255,0.65);
      backdrop-filter:blur(18px);
      border-top:1px solid rgba(0,0,0,0.08);
      display:flex;justify-content:center;
    }
    .tabbar-inner{
      max-width:520px;width:100%;
      display:grid;grid-template-columns:repeat(3,1fr);
      padding:10px 18px 18px;gap:6px;align-items:center;
    }
    .tab{
      text-decoration:none;color:var(--secondary);
      display:grid;place-items:center;gap:6px;
      font-weight:800;padding:8px 0;
    }
    .tab .icon{font-size:24px;line-height:1}
    .tab.active{color:var(--accent)}

    /* ===== iOS-style tap feedback ===== */
    a, button, .seg-btn, .save, .tab{ -webkit-tap-highlight-color:transparent; }
    .seg-btn, .save, .tab, button{
      user-select:none;-webkit-user-select:none;
      transition:opacity .15s ease, transform .10s ease, background-color .15s ease;
    }
    .seg-btn:active{opacity:.65;transform:scale(.98);}
    .save:active{opacity:.65;transform:scale(.98);}
    .tab:active{opacity:.6;transform:scale(.98);}
    .seg-btn:focus, .save:focus, .tab:focus, button:focus{outline:none;}

    /* ===== iOS Êó•Êúü input ÊñáÂ≠óÈ°èËâ≤ÔºàÁµ±‰∏ÄÊéßËâ≤Ôºâ ===== */
    input[type="date"]{
      color:var(--accent-text);
      -webkit-text-fill-color:var(--accent-text);
    }
    input[type="date"]::-webkit-datetime-edit{ color:var(--accent-text); }
    input[type="date"]::-webkit-datetime-edit-text,
    input[type="date"]::-webkit-datetime-edit-month-field,
    input[type="date"]::-webkit-datetime-edit-day-field,
    input[type="date"]::-webkit-datetime-edit-year-field{
      color:var(--accent-text);
    }
  </style>
</head>

<body>
  <div class="app">
    <main class="page">
      <div class="nav-title">Êñ∞Â¢û</div>

      <!-- È°ûÂûãÔºàsegmentedÔºâ -->
      <section class="section">
        <div class="label">È°ûÂûã</div>
        <div class="segment" role="tablist" aria-label="È°ûÂûã">
          <button class="seg-btn active" id="btn-expense" type="button" aria-pressed="true">ÊîØÂá∫</button>
          <button class="seg-btn" id="btn-income" type="button" aria-pressed="false">Êî∂ÂÖ•</button>
        </div>
      </section>

      <!-- Êó•Êúü/ÂàÜÈ°û/ÈáëÈ°ç/ÂÇôË®ª -->
      <section class="section">
        <div class="card">
          <div class="field">
            <div class="label">Êó•Êúü</div>
            <input class="input" type="date" id="date" />
          </div>

          <div class="field">
            <div class="label">ÂàÜÈ°û</div>
            <select class="input" id="category">
              <option>È§êÈ£≤</option>
              <option>È£≤Êñô</option>
              <option>‰∫§ÈÄö</option>
              <option>ÈÜ´ÁôÇ</option>
              <option selected>ÂÖ∂‰ªñ</option>
            </select>
          </div>

          <div class="field">
            <div class="label">ÈáëÈ°ç</div>
            <input class="input" type="number" id="amount" inputmode="decimal" placeholder="Ëº∏ÂÖ•ÈáëÈ°ç" />
          </div>

          <div class="field">
            <div class="label">ÂÇôË®ª</div>
            <input class="input" type="text" id="note" placeholder="ÂÇôË®ªÔºàÂèØÁ©∫Ôºâ" />
          </div>
        </div>

        <button class="save" id="saveBtn" type="button">ÂÑ≤Â≠ò</button>
      </section>
    </main>

    <!-- Tab Bar -->
    <nav class="tabbar" aria-label="Tab Bar">
      <div class="tabbar-inner">
        <a class="tab active" href="add.html"><div class="icon">Ôºã</div><div>Êñ∞Â¢û</div></a>
        <a class="tab" href="month.html"><div class="icon">‚ñ¶</div><div>Êú¨Êúà</div></a>
        <a class="tab" href="year.html"><div class="icon">üìà</div><div>Âπ¥Â∫¶</div></a>
      </div>
    </nav>
  </div>

  <!-- ‚úÖ ÂÖ±Áî®ÔºöTab È´ò‰∫Æ + Page Transition -->
  <script src="app.js"></script>

  <!-- ‚úÖ ÈÄôÈ†ÅÂ∞àÁî®ÔºöÊñ∞Â¢ûÂ≠òÊ™î -->
  <script>
    // ===== helpers =====
    function pad2(n){ return String(n).padStart(2,"0"); }
    function todayYMD(){
      const d = new Date();
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    }
    function nowHHMM(){
      const d = new Date();
      return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }
    function getTxIndex(){
      try{
        const raw = localStorage.getItem("tx:index");
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      }catch(e){
        return [];
      }
    }
    function setTxIndex(arr){
      localStorage.setItem("tx:index", JSON.stringify(arr));
    }

    // ===== state: type =====
    let currentType = "expense"; // expense | income
    const btnExpense = document.getElementById("btn-expense");
    const btnIncome  = document.getElementById("btn-income");

    function setType(t){
      currentType = t;
      const isExpense = t === "expense";

      btnExpense.classList.toggle("active", isExpense);
      btnIncome.classList.toggle("active", !isExpense);

      btnExpense.setAttribute("aria-pressed", String(isExpense));
      btnIncome.setAttribute("aria-pressed", String(!isExpense));
    }

    btnExpense.addEventListener("click", () => setType("expense"));
    btnIncome.addEventListener("click",  () => setType("income"));

    // ===== default date =====
    (function setTodayIfEmpty(){
      const dateInput = document.getElementById("date");
      if(dateInput && !dateInput.value) dateInput.value = todayYMD();
    })();

    // ===== save =====
    document.getElementById("saveBtn").addEventListener("click", () => {
      const date = document.getElementById("date").value || todayYMD();
      const time = nowHHMM();
      const category = (document.getElementById("category").value || "").trim();
      const note = (document.getElementById("note").value || "").trim();

      const amtRaw = document.getElementById("amount").value;
      const amount = Number(String(amtRaw).replace(/,/g,""));

      if(!isFinite(amount) || amount <= 0){
        alert("Ë´ãËº∏ÂÖ•Ê≠£Á¢∫ÈáëÈ°çÔºà> 0Ôºâ");
        return;
      }

      const id = "tx-" + Date.now();
      const data = {
        id,
        date,
        time,
        type: currentType,
        amount: String(amount),
        category,
        note
      };

      localStorage.setItem("tx:" + id, JSON.stringify(data));

      const idx = getTxIndex();
      idx.unshift(id);
      setTxIndex(idx);

      location.href = "month.html";
    });
  </script>
</body>
</html>